<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Firebase_version9_RealtimeDB(G'sACADEMYåˆå­¦è€…ç”¨ã‚µãƒ³ãƒ—ãƒ«)</title>
    <link rel="stylesheet" href="css/reset.css">
    <link rel="stylesheet" href="css/style.css">
</head>

<body>

    <h1>ãƒãƒ£ãƒƒãƒˆã‚¢ãƒ—ãƒª</h1>
    <!-- ã‚³ãƒ³ãƒ†ãƒ³ãƒ„è¡¨ç¤ºç”»é¢ -->
    <div>
        <!-- å„å ´æ‰€ã«idã‚’è¨­å®šã—ã¾ã—ã‚‡ã† -->
        <div>
            <input type="text" id="uname" placeholder="åå‰ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„">
        </div>
        <div>
            <textarea id="text" placeholder="æ–‡ç« ã‚’å…¥åŠ›ã—ã¦ãã ã•ã„"></textarea>
        </div>
        <div class="button-area">
            <div class="buttons">
                <a id="send" href="#">é€ä¿¡</a>
            </div>
            <div class="buttons">
                <a id="clear" href="#">ã™ã¹ã¦å‰Šé™¤</a>
            </div>
            <div class="buttons">
                <a id="onedelete" href="#">æœ€æ–°ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’å‰Šé™¤</a>
            </div>
        </div>
       
       
        <!-- style.cssã« "overflow: auto;"ã‚’æ›¸ã„ã¦ã¿ã¾ã—ã‚‡ã†ï¼â€»æœ€å¾Œã« -->
        <div id="output">

        </div>
    </div>


    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script type="module">
        // Import the functions you need from the SDKs you need
        import { initializeApp } from "https://www.gstatic.com/firebasejs/9.1.0/firebase-app.js";
        import {                  
                getDatabase,
                ref,
                push,
                set,
                update,
                remove,
                onChildAdded,
                onChildChanged,
                onChildRemoved,
                onDisconnect,
                serverTimestamp, 
            }
            from "https://www.gstatic.com/firebasejs/9.1.0/firebase-database.js";


    // import { doc, updateDoc, deleteField } from "firebase/firestore";

        // Your web app's Firebase configuration
        // For Firebase JS SDK v7.20.0 and later, measurementId is optional
            const firebaseConfig = {
              
            };
        const app = initializeApp(firebaseConfig);
        const db = getDatabase(app); //RealtimeDBã«æ¥ç¶š
        const dbRef = ref(db, "chat"); //RealtimeDBå†…ã®"chat"ã‚’ä½¿ã†


        $("#send").on("click",function(){
            const uname = $("#uname").val();
            const text = $("#text").val();
            alert(uname+text); // å–å¾—ç¢ºèª
        });





        //ãƒ‡ãƒ¼ã‚¿ç™»éŒ²(Click)
        $("#send").on("click",function() {
            const msg = {
                uname: $("#uname").val(),
                text: $("#text").val()
            }
            const newPostRef = push(dbRef);
            set(newPostRef, msg);


            // firebaseã«ç™»éŒ²ãŒçµ‚ã‚ã£ãŸã‚‰ã€å…¥åŠ›æ¬„ã‚’ç©ºæ¬„ã«ã—ã¾ã™
            $("#uname").val("");
            $("#text").val("");

        });

         //ãƒ‡ãƒ¼ã‚¿ç™»éŒ²(Enter)
            $("#text").on("keydown", function (e) {
                console.log(e);        //eå¤‰æ•°ã®ä¸­èº«ã‚’ç¢ºèªï¼ï¼
                if (e.keyCode == 13) {   //EnterKey=13
                    const msg = {
                        uname: $("#uname").val(),
                        text: $("#text").val()
                    }
                    const newPostRef = push(dbRef); //ãƒ¦ãƒ‹ãƒ¼ã‚¯KEYã‚’ç”Ÿæˆ
                    set(newPostRef, msg);
                               //"chat"ã«ãƒ¦ãƒ‹ãƒ¼ã‚¯KEYã‚’ã¤ã‘ã¦ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’ç™»éŒ²
                }

            });



         //æœ€åˆã«ãƒ‡ãƒ¼ã‚¿å–å¾—ï¼†onSnapshotã§ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã«ãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—
          onChildAdded(dbRef, function (data) {
                const msg = data.val();  //ã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãƒ‡ãƒ¼ã‚¿ã‚’å–å¾—ã—ã€å¤‰æ•°msgã«ä»£å…¥
                const key = data.key; //ãƒ‡ãƒ¼ã‚¿ã®ãƒ¦ãƒ‹ãƒ¼ã‚¯ã‚­ãƒ¼ï¼ˆå‰Šé™¤ã‚„æ›´æ–°ã«ä½¿ç”¨å¯èƒ½ï¼‰

                //è¡¨ç¤ºç”¨ãƒ†ã‚­ã‚¹ãƒˆãƒ»HTMLã‚’ä½œæˆ
              let h = `
                <div class="box" id=${key}>
                    <p>${msg.uname}</p>
                    <p>${msg.text}</p>
                </div>
            `

              // jQueryã‚’ä½¿ã£ã¦ç”»é¢ã«è¡¨ç¤ºã—ã¾ã—ã‚‡ã†ğŸ¤—
              $("#output").append(h);



              // ã“ã®ä¸‹æ¶ˆã•ãªã„
          });



           
                // $("#clear").on("click", function () {


                //     // Remove the 'capital' field from the document
                //     await updateDoc(cityRef, {
                //         capital: deleteField()
                //     });
                    

                       

                //     });



    </script>
</body>

</html>